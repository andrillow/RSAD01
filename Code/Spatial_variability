# Code to measure spatial variability considering both (i) spectral indices and (ii) relative abudances

library(terra)
library(imageRy)
library(rasterdiv)

im.list()
glacier_image <- im.import("sentinel.png")
glacier_image <- c(glacier_image [[1]], glacier_image [[2]], glacier_image [[3]])
glacier_RGB <- im.plotRGB(glacier_image, 1, 2, 3, title="NIR on red component")
glacier_RGB2 <- im.plotRGB(glacier_image, 3, 1, 2, title="NIR on green component")
glacier_RGB2 <- im.plotRGB(glacier_image, 3, 2, 1, title="NIR on blue component")

# Calculate standard deviation
# Formula: sqrt(sum((x - mean(x))^2) / n)
# Variance: SD^2
NIR <- glacier_image [[1]]
Variability1a <- focal(NIR, matrix(1/9,3,3), fun=sd)
plot(Variability1a)
Variability1b <- focal(NIR, matrix(1/25,5,5), fun=sd)
plot(Variability1b)
Variability1c <- focal(NIR, matrix(1/49,7,7), fun=sd)
plot(Variability1c)
im.ggplot(Variability) #same map using ggplot
Variability2 <- focal(NIR, matrix(1/9,3,3), fun=var) # using variance instead of standard deviation
plot(Variability2)
# Standard deviation versus variance
par(mfrow=c(1,2))
plot(Variability1a)
plot(Variability2)
dev.off()

# Shannon index: abundance-based method
Shannon_diversity <- Shannon(NIR, window=3)
plot(Shannon_diversity)
Shannon_diversity_ggplot <- im.ggplot(Shannon_diversity)

# Cropping the image
extent <- c(0, 100, 0, 100)
cropped_NIR <- crop(NIR, extent)
plot(cropped_NIR)

